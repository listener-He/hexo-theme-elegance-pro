<%
  // Determine theme and language
  const themeMode = theme.theme_mode === 'auto' 
    ? (typeof is_dark === 'function' && is_dark() ? 'night' : 'day')
    : theme.theme_mode || 'day';
    
  const lang = theme.i18n.default_lang || 'zh-CN';
  
  // Analytics config
  const analytics = theme.analytics || {};
  const seo = theme.seo || {};
  
  // Injections config
  const injections = theme.injections || {};
  const headInjections = injections.head || [];
%>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <title><%= config.title %></title>
  
  <% if (config.description) { %>
    <meta name="description" content="<%= config.description %>">
  <% } %>
  
  <% if (config.keywords) { %>
    <meta name="keywords" content="<%= config.keywords %>">
  <% } %>
  
  <!-- Accessibility meta tags -->
  <meta name="theme-color" content="#3b82f6">
  
  <!-- SEO meta tags -->
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  
  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  <!-- Theme color for mobile browsers -->
  <meta name="theme-color" content="#3b82f6">
  
  <!-- Open Graph -->
  <meta property="og:title" content="<%= config.title %>">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= config.url %>">
  <% if (config.description) { %>
    <meta property="og:description" content="<%= config.description %>">
  <% } %>
  <meta property="og:site_name" content="<%= config.title %>">
  
  <!-- Article specific OG tags (for posts) -->
  <% if (page && page.title) { %>
    <meta property="og:title" content="<%= page.title %>">
  <% } %>
  
  <% if (page && page.description) { %>
    <meta property="og:description" content="<%= page.description %>">
  <% } else if (page && page.excerpt) { %>
    <meta property="og:description" content="<%= strip_html(page.excerpt) %>">
  <% } %>
  
  <% if (page && page.permalink) { %>
    <meta property="og:url" content="<%= config.url %><%= page.permalink %>">
  <% } %>
  
  <% if (page && page.photos && page.photos.length > 0) { %>
    <meta property="og:image" content="<%= config.url %><%= page.photos[0] %>">
  <% } %>
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= config.title %>">
  <% if (config.description) { %>
    <meta name="twitter:description" content="<%= config.description %>">
  <% } %>
  
  <!-- Article specific Twitter tags (for posts) -->
  <% if (page && page.title) { %>
    <meta name="twitter:title" content="<%= page.title %>">
  <% } %>
  
  <% if (page && page.description) { %>
    <meta name="twitter:description" content="<%= page.description %>">
  <% } else if (page && page.excerpt) { %>
    <meta name="twitter:description" content="<%= strip_html(page.excerpt) %>">
  <% } %>
  
  <% if (page && page.photos && page.photos.length > 0) { %>
    <meta name="twitter:image" content="<%= config.url %><%= page.photos[0] %>">
  <% } %>
  
  <% if (theme.seo && theme.seo.twitter_site) { %>
    <meta name="twitter:site" content="<%= theme.seo.twitter_site %>">
  <% } %>
  
  <% if (theme.seo && theme.seo.twitter_creator) { %>
    <meta name="twitter:creator" content="<%= theme.seo.twitter_creator %>">
  <% } %>
  
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="<%= config.title %>" type="application/atom+xml">
  
  <!-- Main CSS -->
  <link rel="stylesheet" href="/css/main.css">
  
  <!-- Theme config for JavaScript access -->
  <script>
    window.themeConfig = <%- JSON.stringify(theme) %>;
    window.siteConfig = <%- JSON.stringify(config) %>;
  </script>
  
  <!-- Custom head injections -->
  <%- inject_point('head') %>
</head>