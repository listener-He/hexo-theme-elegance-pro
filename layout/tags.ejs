<%- extends 'layout.ejs' %>

<% block content %>
<div class="tags-page py-5">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-9">
        <!-- Page Header -->
        <header class="page-header mb-5 text-center">
          <h1 class="page-title gradient-text mb-3" 
              data-i18n="tags.title"
              data-text-zh="<%= theme.tags.title || '标签云' %>"
              data-text-en="<%= theme.tags.title_en || 'Tags' %>">
            <%= theme.tags.title || '标签云' %>
          </h1>
          <p class="page-subtitle text-muted" data-i18n="tags.total" data-i18n-param-count="<%= tags.length %>">
            共计 <%= tags.length %> 个标签
          </p>
        </header>

        <!-- Tags Content -->
        <div class="tags-content">
          <% if (tags.length > 0) { %>
            <!-- Tag Cloud -->
            <div class="tag-cloud-section">
              <div class="tag-cloud mb-5">
                <% 
                  // Find max post count for sizing
                  const maxCount = Math.max(...tags.map(tag => tag.posts.length));
                  const minCount = Math.min(...tags.map(tag => tag.posts.length));
                %>
                
                <% tags.forEach(tag => { %>
                  <% 
                    // Calculate size based on post count
                    const size = 12 + ((tag.posts.length - minCount) / (maxCount - minCount)) * 12;
                  %>
                  <a href="<%= url_for(tag.path) %>" 
                     class="tag tag--lg me-2 mb-2 tag--gradient"
                     style="font-size: <%= size %>px;">
                    <%= tag.name %> (<%= tag.posts.length %>)
                  </a>
                <% }); %>
              </div>
            </div>
            
            <!-- Tag List -->
            <div class="tag-list-section">
              <h2 class="section-title mb-4" data-i18n="tags.allTags"><%= theme.tags.all_tags || '全部标签' %></h2>
              <div class="row">
                <% tags.forEach(tag => { %>
                  <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card card--tag h-100">
                      <div class="card__body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                          <h3 class="card__title h5 mb-0">
                            <a href="<%= url_for(tag.path) %>" class="text-decoration-none">
                              <%= tag.name %>
                            </a>
                          </h3>
                          <span class="badge bg-primary ms-2">
                            <%= tag.posts.length %>
                          </span>
                        </div>
                        <div class="tag-posts mt-3">
                          <% if (tag.posts && tag.posts.length > 0) { %>
                            <ul class="list-unstyled mb-0">
                              <% tag.posts.slice(0, 5).forEach(post => { %>
                                <li class="mb-2">
                                  <a href="<%= url_for(post.path) %>" class="text-decoration-none text-muted small">
                                    <%= post.title || '无标题' %>
                                  </a>
                                </li>
                              <% }); %>
                            </ul>
                            <% if (tag.posts.length > 5) { %>
                              <div class="text-center mt-3">
                                <a href="<%= url_for(tag.path) %>" class="btn btn--sm btn--outline">
                                  <span data-i18n="tags.viewAll" data-i18n-param-count="<%= tag.posts.length %>"><%= theme.tags.view_all || '查看全部' %> <%= tag.posts.length %> <%= theme.archive.count_suffix || '篇文章' %></span>
                                </a>
                              </div>
                            <% } %>
                          <% } else { %>
                            <p class="text-muted small mb-0" data-i18n="tags.empty"><%= theme.tags.no_posts || '这个标签下还没有文章' %></p>
                          <% } %>
                        </div>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } else { %>
            <div class="empty-state text-center py-5">
              <h3 class="mb-3" data-i18n="tags.empty.title"><%= theme.tags.empty_title || '暂无标签' %></h3>
              <p class="text-muted" data-i18n="tags.empty.description"><%= theme.tags.empty_description || '还没有创建任何标签' %></p>
              <a href="<%= url_for('/') %>" class="btn btn--primary" data-i18n="common.backHome"><%= __('common.backHome') || '返回首页' %></a>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>
<% endblock %>